{
  "name": "News Summarizer (v8 - Single Best Article)",
  "nodes": [
    {
      "parameters": {
        "chatId": "2075065850",
        "text": "ğŸš€ Ù¾Ø±Ø¯Ø§Ø²Ø´ 9 Ù…Ù†Ø¨Ø¹ Ø®Ø¨Ø±ÛŒ Ø¢ØºØ§Ø² Ø´Ø¯...",
        "additionalFields": {}
      },
      "name": "Send Initial Status",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -4256,
        208
      ],
      "id": "bd82fdb9-4828-4ed2-ae2c-d66e5e8d8278",
      "webhookId": "fd181777-91e2-4f9a-9ad1-779f6ce3c151",
      "credentials": {
        "telegramApi": {
          "id": "0pPxcLhD8qdqCKlG",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {},
      "name": "Daily Trigger",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        -4480,
        208
      ],
      "id": "688f8a7b-ade5-41b5-87b2-d1247bd6ea2f"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://atom-game.ir/api/users/auth/admin-login/",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \"username\": \"amir\", \"password\": \"@mir1385514\" } }}",
        "options": {}
      },
      "name": "Auth Tokens",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -4368,
        208
      ],
      "id": "5f9f0a1d-3c0e-4c91-8af0-7b8e6b6bb001"
    },
    {
      "parameters": {
        "functionCode": "const sources = [\n  {source:'GameSpot',  url:'https://www.gamespot.com/feeds/news'},\n  {source:'Kotaku',    url:'https://kotaku.com/feed'},\n  {source:'PCGamer',   url:'https://www.pcgamer.com/rss/'},\n  {source:'Polygon',   url:'https://www.polygon.com/rss/polygon-archives/index.xml'},\n  {source:'Eurogamer', url:'https://www.eurogamer.net/feed'},\n  {source:'VG247',     url:'https://www.vg247.com/feed'},\n  {source:'Gematsu',   url:'https://www.gematsu.com/feed'},\n  {source:'XboxWire',  url:'https://news.xbox.com/en-us/feed/'},\n  {source:'GamesPress',url:'https://www.gamespress.com/en-gb/News/RSS'}\n];\n\nconst message_id = $items()[0].json.result.message_id;\n\nreturn sources.map((item, index) => {\n  return {\n    json: {\n      ...item,\n      message_id: message_id,\n      itemIndex: index\n    }\n  };\n});"
      },
      "name": "Prepare Sources & Add IDs",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -4032,
        208
      ],
      "id": "55b74105-c597-4e8f-98c4-ab77a54e0988"
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "name": "Split Sources",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 1,
      "position": [
        -3808,
        208
      ],
      "id": "4577b81a-9720-4de0-8b51-1574405fd1e8"
    },
    {
      "parameters": {
        "url": "={{$json.url}}",
        "options": {}
      },
      "name": "RSS Feed Read",
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1,
      "position": [
        -3584,
        -160
      ],
      "id": "cf10c947-279a-4cda-bd89-e5c48fc203ca",
      "continueOnFail": true
    },
    {
      "parameters": {
        "functionCode": "const parentData = $items('Split Sources')[0].json;\n\nif (items.length === 0) {\n  return [{ json: { ...parentData, success: false } }];\n}\n\nreturn items.map((article) => {\n  return {\n    json: {\n      ...article.json,\n      source: parentData.source,\n      message_id: parentData.message_id,\n      itemIndex: parentData.itemIndex,\n      success: true,\n    },\n  };\n});"
      },
      "name": "Tag Success/Fail",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -3360,
        -160
      ],
      "id": "2682a187-b80a-45c3-92e4-b2b14b95cb74"
    },
    {
      "parameters": {
        "functionCode": "const parentData = $items('Split Sources')[0].json;\n\nconst anySuccess = items.some(i => i.json && i.json.success === true);\n\nreturn [{\n  json: {\n    source: parentData.source,\n    success: anySuccess,\n    message_id: parentData.message_id,\n    itemIndex: parentData.itemIndex\n  }\n}];"
      },
      "name": "Status Per Source",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -3136,
        -16
      ],
      "id": "8fd1e038-e913-48ed-866c-8bb93525da9e"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.message_id}}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "name": "If Has MsgID",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -2912,
        128
      ],
      "id": "0c04466f-877f-4ba7-8dce-a7574da056d4"
    },
    {
      "parameters": {},
      "name": "Wait for Loop to Finish",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [
        -3136,
        -256
      ],
      "id": "ac5cb2cd-aa9d-430a-9190-a0d9a99a0a12"
    },
    {
      "parameters": {
        "functionCode": "// This node now receives a complete list of all articles from the Merge node.\n// No need for $items() anymore.\nconst allItems = items;\n\nconst firstValidItem = allItems.find(i => i.json && i.json.message_id);\nconst messageId = firstValidItem ? firstValidItem.json.message_id : null;\n\nconst validArticles = allItems.filter(i => i.json && i.json.success && i.json.title);\n\nconst seen = new Set();\nconst uniqueArticles = validArticles.filter(item => {\n  const key = item.json.link || item.json.title;\n  if (seen.has(key)) {\n    return false;\n  } else {\n    seen.add(key);\n    return true;\n  }\n});\n\nconst finalArticles = uniqueArticles.map(item => {\n  const json = item.json;\n  return {\n    title: json.title || \"Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†\",\n    link: json.link || \"#\",\n    source: json.source || \"Ù†Ø§Ù…Ø´Ø®Øµ\",\n    rawContent: json.contentSnippet || json.content || \"\"\n  };\n});\n\nreturn [{\n  json: {\n    articles: finalArticles,\n    messageId: messageId\n  }\n}];"
      },
      "name": "Filter & Prepare All Articles",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -2912,
        -256
      ],
      "id": "24055fc9-f4eb-4c7d-9e27-e70c7994e11a"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.error}}",
              "value2": true
            }
          ]
        }
      },
      "name": "Check for Prep Error",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -2688,
        -208
      ],
      "id": "5dad9e1e-6041-4177-ace9-35b6602b7c67"
    },
    {
      "parameters": {
        "chatId": "2075065850",
        "text": "={{ `âŒ Ø®Ø·Ø§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ:\n${$json.errorMessage}` }}",
        "additionalFields": {}
      },
      "name": "Send Error to Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -2464,
        -208
      ],
      "id": "61a46140-f6a8-4eb3-adc8-bd7467b2de13",
      "webhookId": "b476a619-cc38-4885-9ab6-ded07a82ccd6",
      "credentials": {
        "telegramApi": {
          "id": "0pPxcLhD8qdqCKlG",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.articles.length}}",
              "operation": "larger"
            }
          ]
        }
      },
      "name": "If Articles Exist",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -2688,
        -400
      ],
      "id": "2a2c90a3-d92c-4a30-8d74-413918a4306c"
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "2075065850",
        "messageId": "={{$json.messageId}}",
        "text": "âœ… Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ø§Ù…Ù„ Ø´Ø¯. Ù…Ù‚Ø§Ù„Ù‡ Ø¬Ø¯ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ù„Ø§ØµÙ‡â€ŒØ³Ø§Ø²ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.",
        "additionalFields": {}
      },
      "name": "Update Final Status (No Articles)",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -2464,
        -400
      ],
      "id": "aeec2072-52d6-43da-8bc1-418ebeb32657",
      "webhookId": "97de5891-6192-4a04-9c9f-a921d44114d5",
      "credentials": {
        "telegramApi": {
          "id": "0pPxcLhD8qdqCKlG",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://atom-game.ir/api/blog/posts/",
        "options": {
          "headers": {
            "Authorization": "={{$node[\"Auth Header\"].json.authorization}}"
          }
        }
      },
      "name": "Get Recent Posts",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -2464,
        -592
      ],
      "id": "19ec72a1-0b6a-4947-b7e2-be80c7ad405a"
    },
    {
      "parameters": {
        "functionCode": "// Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø§Ø±ÛŒÙ… Ø§ÛŒÙ† Ù†ÙˆØ¯ Ø¨Ø¹Ø¯ Ø§Ø² \"Get Recent Posts\" Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯.\nconst data = $json || {};\nconst results = Array.isArray(data.results) ? data.results : [];\n\nconst tagScores = {};\nconst categoryScores = {};\nconst TOTAL_WEIGHT_VIEWS = 1;\nconst TOTAL_WEIGHT_LIKES = 10;\nconst TOTAL_WEIGHT_COMMENTS = 20;\n\nfor (const post of results) {\n  const views = Number(post.views_count || 0);\n  const likes = Number(post.likes_count || 0);\n  const comments = Number(post.comments_count || 0);\n  const score = views * TOTAL_WEIGHT_VIEWS + likes * TOTAL_WEIGHT_LIKES + comments * TOTAL_WEIGHT_COMMENTS;\n\n  if (Array.isArray(post.tags)) {\n    for (const tag of post.tags) {\n      const key = tag.slug || tag.name || '';\n      if (!key) continue;\n      tagScores[key] = (tagScores[key] || 0) + score;\n    }\n  }\n\n  const cat = post.category;\n  if (cat) {\n    categoryScores[cat] = (categoryScores[cat] || 0) + score;\n  }\n}\n\nfunction topEntries(obj, limit = 5) {\n  return Object.entries(obj)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, limit)\n    .map(([key, score]) => ({ key, score }));\n}\n\nconst topTags = topEntries(tagScores, 7);\nconst topCategories = topEntries(categoryScores, 5);\n\nconst lines = [];\nif (topTags.length) {\n  lines.push('ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ø§Ø®ÛŒØ±:');\n  for (const t of topTags) {\n    lines.push(`- ${t.key} (Ø§Ù…ØªÛŒØ§Ø² ØªÙ‚Ø±ÛŒØ¨ÛŒ: ${t.score})`);\n  }\n  lines.push('');\n}\n\nif (topCategories.length) {\n  lines.push('Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ø§Ø®ÛŒØ±:');\n  for (const c of topCategories) {\n    lines.push(`- ${c.key} (Ø§Ù…ØªÛŒØ§Ø² ØªÙ‚Ø±ÛŒØ¨ÛŒ: ${c.score})`);\n  }\n  lines.push('');\n}\n\nif (!lines.length) {\n  lines.push('Ø¯Ø§Ø¯Ù‡ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ø³Ø¦Ùˆ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.');\n}\n\nreturn [{\n  json: {\n    seo_insights: {\n      top_tags: topTags,\n      top_categories: topCategories\n    },\n    seo_summary_text: lines.join('\\n')\n  }\n}];\n"
      },
      "name": "Analyze SEO Performance",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -2240,
        -592
      ],
      "id": "d8d2bf87-b212-4b05-8bfc-6052ce4b7079"
    },
    {
      "parameters": {
        "functionCode": "const seo = $json || {};\n\nreturn [{\n  json: {\n    memory_context: {\n      seo_summary_text: seo.seo_summary_text || '',\n      seo_insights: seo.seo_insights || {}\n    }\n  }\n}];\n"
      },
      "name": "AI Memory Builder",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -2128,
        -592
      ],
      "id": "0e8a3f3b-9b6b-4c3e-8f56-5fbb2e6f8888"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={\n  \"summary_markdown\":\n`ØªÙˆ ÛŒÚ© Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒØ³Øª Ø³Ø¦ÙˆØŒ Content Expander Ùˆ Â«AI Reviewer Ø¯ÙˆÙ…Â» Ø¨Ø±Ø§ÛŒ ÙˆØ¨Ù„Ø§Ú¯ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒØ¯ÛŒÙˆÛŒÛŒ atom-game.ir Ù‡Ø³ØªÛŒ.\n\nØ­Ø§ÙØ¸Ù‡Ù” Ú©ÙˆØªØ§Ù‡â€ŒÙ…Ø¯Øª ØªÙˆ Ø§Ø² Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³Ø¦Ùˆ (memory_context):\n${JSON.stringify($items(\"AI Memory Builder\")[0].json.memory_context || {}, null, 2)}\n\nØ¢Ù…Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³Ø¦Ùˆ Ø¯Ø± Ù¾Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ± (Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨Ø§Ø²Ø¯ÛŒØ¯ØŒ Ù„Ø§ÛŒÚ© Ùˆ Ú©Ø§Ù…Ù†Øª):\n${$items(\"AI Memory Builder\")[0].json.memory_context?.seo_summary_text || $items(\"Analyze SEO Performance\")[0].json.seo_summary_text || 'Ø¢Ù…Ø§Ø±ÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª.'}\n\nÙ…Ø§Ù…ÙˆØ±ÛŒØª ØªÙˆ Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡:\n1) Ø§Ø² Ø¨ÛŒÙ† Ø®Ø¨Ø±Ù‡Ø§ÛŒ Ø²ÛŒØ±ØŒ ÙÙ‚Ø· Ùˆ ÙÙ‚Ø· 1 Ø®Ø¨Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù† Ú©Ù‡:\n   - Ù¾ØªØ§Ù†Ø³ÛŒÙ„ Ø¨Ø§Ù„Ø§ÛŒ Ø³Ø±Ú† Ø¯Ø± Ú¯ÙˆÚ¯Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ (ØªØ±Ù†Ø¯ØªØ±ØŒ Ø¬Ø°Ø§Ø¨â€ŒØªØ±ØŒ Ø¨Ø­Ø«â€ŒØ¨Ø±Ø§Ù†Ú¯ÛŒØ²ØªØ±)\n   - Ø¨Ø±Ø§ÛŒ Ú¯ÛŒÙ…Ø±Ù‡Ø§ (PC, PlayStation, Xbox, Nintendo, Ù…ÙˆØ¨Ø§ÛŒÙ„) Ø¬Ø°Ø§Ø¨ Ø¨Ø§Ø´Ø¯\n   - Ø¨ØªÙˆØ§Ù† Ø­ÙˆÙ„ Ø¢Ù† ÛŒÚ© Ù¾Ø³Øª ÙˆØ¨Ù„Ø§Ú¯ÛŒ Ù…Ù†Ø³Ø¬Ù… Ùˆ Ù…ÙÛŒØ¯ Ù†ÙˆØ´Øª\n2) Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‡Ù…Ø§Ù† 1 Ø®Ø¨Ø±ØŒ ÛŒÚ© Ù¾Ø³Øª ÙˆØ¨Ù„Ø§Ú¯ ÙˆØ§Ø­Ø¯ Ùˆ Ù…Ù†Ø³Ø¬Ù… ØªÙˆÙ„ÛŒØ¯ Ú©Ù†.\n3) Ø§Ø¨ØªØ¯Ø§ Ù…ØªÙ† Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ (Content Expander)ØŒ Ø³Ù¾Ø³ Ø®ÙˆØ¯Øª Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† Â«AI Reviewer Ø¯ÙˆÙ…Â»:\n   - ØºÙ„Ø·â€ŒÙ‡Ø§ÛŒ Ù†Ú¯Ø§Ø±Ø´ÛŒ Ùˆ Ø¹Ø¨Ø§Ø±Ø§ØªÛŒ Ú©Ù‡ Ù…Ø¨Ù‡Ù… ÛŒØ§ Ø®ÛŒÙ„ÛŒ Ú©Ù„ÛŒÚ©â€ŒØ¨ÛŒØªÛŒ Ù‡Ø³ØªÙ†Ø¯ Ø±Ø§ Ø§ØµÙ„Ø§Ø­ Ú©Ù†\n   - Ø³Ø§Ø®ØªØ§Ø± Ù…ØªÙ† Ø±Ø§ Ø¨Ù‡ØªØ± Ú©Ù† (Ù‡Ø¯ÛŒÙ†Ú¯â€ŒÙ‡Ø§ØŒ Ø¨ÙˆÙ„Øªâ€ŒÙ‡Ø§ØŒ Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ùâ€ŒÙ‡Ø§ÛŒ Ú©ÙˆØªØ§Ù‡)\n4) Ù…Ø­ØªÙˆØ§ Ø¨Ø§ÛŒØ¯:\n   - Ø³Ø§Ø®ØªØ§Ø± Ù…Ù†Ø·Ù‚ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ (Ù…Ù‚Ø¯Ù…Ù‡ØŒ Ø¨Ø¯Ù†Ù‡ØŒ Ø¬Ù…Ø¹â€ŒØ¨Ù†Ø¯ÛŒ)\n   - Ù‚Ø§Ø¨Ù„ Ø§Ø³Ú©Ù† Ø¨Ø§Ø´Ø¯ (Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ùâ€ŒÙ‡Ø§ÛŒ Ú©ÙˆØªØ§Ù‡ØŒ Ù‡Ø¯ÛŒÙ†Ú¯â€ŒÙ‡Ø§ÛŒ H2/H3 Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²ØŒ Ø¨ÙˆÙ„Øªâ€ŒÙ„ÛŒØ³Øª Ø¯Ø± Ø¬Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨)\n   - Ù„Ø­Ù† Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ùˆ Ø¯ÙˆØ³ØªØ§Ù†Ù‡Ù” Ù…Ù†Ø§Ø³Ø¨ ÙˆØ¨Ù„Ø§Ú¯ Ú¯ÛŒÙ…ÛŒÙ†Ú¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯\n5) Ù‚ÙˆØ§Ù†ÛŒÙ† Ø³Ø¦Ùˆ:\n   - Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ Ùˆ seo_title Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ú©Ù„Ù…Ù‡Ù” Ú©Ù„ÛŒØ¯ÛŒ Ù…Ù‡Ù… Ø±Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù†Ø¯.\n   - seo_title ØªØ±Ø¬ÛŒØ­Ø§Ù‹ Ø²ÛŒØ± Û¶Ûµ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.\n   - seo_description Ø¨ÛŒÙ† Û±Û´Û° ØªØ§ Û±Û¶Û° Ú©Ø§Ø±Ø§Ú©ØªØ± Ùˆ Ø´Ø§Ù…Ù„ Û± ØªØ§ Û² Ú©Ù„Ù…Ù‡Ù” Ú©Ù„ÛŒØ¯ÛŒ Ø¨Ø§Ø´Ø¯.\n   - Ø§Ø² Ú©Ù„ÛŒÚ©â€ŒØ¨ÛŒØª Ø¨Ø³ÛŒØ§Ø± Ø§ØºØ±Ø§Ù‚â€ŒØ¢Ù…ÛŒØ² Ø¯ÙˆØ±ÛŒ Ú©Ù†ØŒ ÙˆÙ„ÛŒ Ø¬Ø°Ø§Ø¨ÛŒØª Ø±Ø§ Ø­ÙØ¸ Ú©Ù†.\n   - Ø§Ø² Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ù‚Ù…Ø§Ø±ØŒ Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø­Ø³Ø§Ø³ Ø¯ÙˆØ±ÛŒ Ú©Ù†.\n6) Ø­ØªÙ…Ø§Ù‹ ÙÙ‚Ø· Ø§Ø² Ù‡Ù…Ø§Ù† 1 Ø®Ø¨Ø± Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù† Ùˆ Ø®Ø¨Ø±Ù‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ø±Ø§ Ù‚Ø§Ø·ÛŒ Ù†Ú©Ù†.\n\nØ®Ø±ÙˆØ¬ÛŒ ØªÙˆ Ø¨Ø§ÛŒØ¯ ÙÙ‚Ø· Ùˆ ÙÙ‚Ø· ÛŒÚ© JSON Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯ Ùˆ Ù‡ÛŒÚ† Ù…ØªÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ø¯Ù‚ÛŒÙ‚Ø§ Ø¨Ø§ Ø§ÛŒÙ† Ø³Ø§Ø®ØªØ§Ø±:\n\n{\n  \"summary_markdown\": \"Ù…ØªÙ† Ù…Ø§Ø±Ú©â€ŒØ¯Ø§ÙˆÙ† Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø¯Ù†Ù‡Ù” Ù¾Ø³Øª ÙˆØ¨Ù„Ø§Ú¯...\",\n  \"title\": \"Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ Ù¾Ø³Øª Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø³Ø§ÛŒØª\",\n  \"title_variants\": [\"Ø¹Ù†ÙˆØ§Ù† Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Û±\", \"Ø¹Ù†ÙˆØ§Ù† Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Û²\", \"Ø¹Ù†ÙˆØ§Ù† Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Û³\"],\n  \"seo_title\": \"Ø¹Ù†ÙˆØ§Ù† Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ø¦Ùˆ (ØªØ±Ø¬ÛŒØ­Ø§Ù‹ Ø²ÛŒØ± Û¶Ûµ Ú©Ø§Ø±Ø§Ú©ØªØ±)\",\n  \"seo_description\": \"ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…ØªØ§ Ø¨ÛŒÙ† Û±Û´Û° ØªØ§ Û±Û¶Û° Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§ Û± ØªØ§ Û² Ú©Ù„Ù…Ù‡Ù” Ú©Ù„ÛŒØ¯ÛŒ Ø§ØµÙ„ÛŒ\",\n  \"category_slug\": \"game-news\",\n  \"series_slug\": \"daily-digest\",\n  \"tags\": [\"GTA 6\", \"Elden Ring\", \"PlayStation\"],\n  \"focus_keywords\": [\"Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Û±\", \"Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Û²\", \"Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Û³\"],\n  \"chosen_index\": 0,\n  \"reason\": \"Ú†Ø±Ø§ Ø§ÛŒÙ† Ø®Ø¨Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯ÛŒ (ÛŒÚ© ÛŒØ§ Ø¯Ùˆ Ø¬Ù…Ù„Ù‡ Ú©ÙˆØªØ§Ù‡)\"\n}\n\nØªÙˆØ¶ÛŒØ­Ø§Øª:\n- chosen_index Ø¨Ø§ÛŒØ¯ Ø§Ù†Ø¯ÛŒØ³ Ø¹Ø¯Ø¯ÛŒ Ù‡Ù…Ø§Ù† Ø®Ø¨Ø±ÛŒ Ø¨Ø§Ø´Ø¯ Ú©Ù‡ Ø§Ø² Ø¨ÛŒÙ† Ù„ÛŒØ³Øª Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒâ€ŒÚ©Ù†ÛŒ (Ø´Ø±ÙˆØ¹ Ø§Ø² 0).\n- Ø§Ú¯Ø± Ø¨Ù‡ Ù‡Ø± Ø¯Ù„ÛŒÙ„ Ù†ØªÙˆØ§Ù†Ø³ØªÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØŒ Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ù†Ø¯ÛŒØ³ 0 Ø±Ø§ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†.\n\nØ­Ø§Ù„Ø§ Ù„ÛŒØ³Øª Ø®Ø¨Ø±Ù‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ø±Ø§ Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒ. ÙÙ‚Ø· Ùˆ ÙÙ‚Ø· Ø§Ø² Ø¨ÛŒÙ† Ø§ÛŒÙ†â€ŒÙ‡Ø§ ÛŒÚ©ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†:\n\n${$items(\"Filter & Prepare All Articles\")[0].json.articles.map((a, index) =>\n  `Ø´Ø§Ø®Øµ: ${index}\nØ¹Ù†ÙˆØ§Ù†: ${a.title}\nÙ…Ù†Ø¨Ø¹: ${a.source}\nÙ„ÛŒÙ†Ú©: ${a.link}\nÙ…Ø­ØªÙˆØ§: ${a.rawContent || ''}`\n).join(\"\\n---\\n\")}\n`,\n  \"title\": \"\",\n  \"title_variants\": [],\n  \"seo_title\": \"\",\n  \"seo_description\": \"\",\n  \"category_slug\": \"game-news\",\n  \"series_slug\": \"daily-digest\",\n  \"tags\": [],\n  \"focus_keywords\": [],\n  \"chosen_index\": 0,\n  \"reason\": \"\"\n}\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -2016,
        -592
      ],
      "id": "b8ba01b3-db8b-4164-aa1e-6f6575ba6d90",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -2000,
        -368
      ],
      "id": "72e78bb8-2e01-4225-9104-eb6b6608f27d",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "7d95eyiHnpp11H1T",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const raw = $json.output || $json.text || $json.response || $json;\n\nlet meta;\ntry {\n  meta = typeof raw === 'string' ? JSON.parse(raw) : raw;\n} catch (e) {\n  const fallbackSummary = typeof raw === 'string' ? raw : JSON.stringify(raw);\n  meta = {\n    summary_markdown: fallbackSummary,\n    title: 'Ø®Ù„Ø§ØµÙ‡ Ù…Ù‡Ù…â€ŒØªØ±ÛŒÙ† Ø®Ø¨Ø±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø§Ù…Ø±ÙˆØ²',\n    seo_title: 'Ø®Ù„Ø§ØµÙ‡ Ù…Ù‡Ù…â€ŒØªØ±ÛŒÙ† Ø®Ø¨Ø±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø§Ù…Ø±ÙˆØ²',\n    seo_description: '',\n    category_slug: 'game-news',\n    series_slug: 'daily-digest',\n    tags: ['Ø§Ø®Ø¨Ø§Ø± Ø¨Ø§Ø²ÛŒ'],\n    focus_keywords: [],\n    chosen_index: 0,\n    reason: 'fallback â€“ JSON parse error'\n  };\n}\n\nconst summary = meta.summary_markdown || meta.summary || '';\nconst baseExcerpt = summary\n  .replace(/[\\r\\n]+/g, ' ')\n  .slice(0, 220);\n\nconst title = meta.title || 'Ø®Ù„Ø§ØµÙ‡ Ù…Ù‡Ù…â€ŒØªØ±ÛŒÙ† Ø®Ø¨Ø±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø§Ù…Ø±ÙˆØ²';\nconst seoTitle = meta.seo_title || title;\nconst seoDescription = meta.seo_description || baseExcerpt;\n\nconst titleVariants = Array.isArray(meta.title_variants) ? meta.title_variants : [];\nconst focusKeywords = Array.isArray(meta.focus_keywords) ? meta.focus_keywords : [];\nconst chosenIndex = Number.isInteger(meta.chosen_index) ? meta.chosen_index : 0;\n\nreturn [{\n  json: {\n    summary_markdown: summary,\n    title,\n    title_variants: titleVariants,\n    excerpt: baseExcerpt,\n    seo_title: seoTitle,\n    seo_description: seoDescription,\n    category_slug: meta.category_slug || 'game-news',\n    series_slug: meta.series_slug || 'daily-digest',\n    tags: Array.isArray(meta.tags) ? meta.tags : ['Ø§Ø®Ø¨Ø§Ø± Ø¨Ø§Ø²ÛŒ'],\n    focus_keywords: focusKeywords,\n    chosen_index: chosenIndex,\n    selection_reason: meta.reason || ''\n  }\n}];\n"
      },
      "name": "Parse AI JSON",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -1664,
        -592
      ],
      "id": "b867bd51-8e6b-4aa5-9235-46d9711db689"
    },
    {
      "parameters": {
        "functionCode": "let { summary_markdown, seo_description } = $json;\n\nfunction cleanUrl(u) {\n  try {\n    const url = new URL(u);\n    const badParams = ['utm_source','utm_medium','utm_campaign','utm_term','utm_content','fbclid','gclid','ref'];\n    badParams.forEach(p => url.searchParams.delete(p));\n    return url.toString();\n  } catch (e) {\n    return u;\n  }\n}\n\nsummary_markdown = summary_markdown || '';\nseo_description = seo_description || '';\n\nconst urlRegex = /(https?:\\/\\/[^\\s)]+[^\\s)\\.,!?])/g;\nsummary_markdown = summary_markdown.replace(urlRegex, (m) => cleanUrl(m));\nseo_description = seo_description.replace(urlRegex, (m) => cleanUrl(m));\n\nconst ytRegex = /(https?:\\/\\/(?:www\\.)?(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([A-Za-z0-9_-]{6,}))/g;\nsummary_markdown = summary_markdown.replace(ytRegex, (match, url, vid) => {\n  const id = vid;\n  return `\\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/${id}\" frameborder=\"0\" allowfullscreen></iframe>\\n`;\n});\n\nconst textForLang = (summary_markdown || seo_description || '').slice(0, 1000);\nconst hasArabic = /[\\u0600-\\u06FF]/.test(textForLang);\nconst lang = hasArabic ? 'fa' : 'en';\n\nreturn [{\n  json: {\n    ...$json,\n    summary_markdown,\n    seo_description,\n    lang\n  }\n}];\n"
      },
      "name": "Clean URLs & Enhance Content",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -1440,
        -592
      ],
      "id": "c3b9f8fb-8f0b-4b58-b28d-2b0f1bbf4444"
    },
    {
      "parameters": {
        "functionCode": "const meta = $json;\nconst wrapper = $items('Filter & Prepare All Articles')[0].json;\nconst articles = Array.isArray(wrapper.articles) ? wrapper.articles : [];\n\nlet idx = Number(meta.chosen_index ?? 0);\nif (!(idx >= 0 && idx < articles.length)) {\n  idx = 0;\n}\n\nconst chosen = articles[idx] || null;\n\nreturn [{\n  json: {\n    ...meta,\n    chosen_article: chosen\n  }\n}];\n"
      },
      "name": "Pick Chosen Article",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -1664,
        -784
      ],
      "id": "dfe29bc7-4ade-4bb2-ae51-690025d21c10"
    },
    {
      "parameters": {
        "url": "={{ $json.chosen_article.link }}",
        "options": {}
      },
      "name": "Fetch Original Article HTML",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -1440,
        -784
      ],
      "id": "d2eb7918-b80e-41fa-b351-f988cb1e60c8"
    },
    {
      "parameters": {
        "functionCode": "const htmlItem = $json;\nconst body = htmlItem.body || htmlItem.data || htmlItem;\nconst text = typeof body === 'string' ? body : JSON.stringify(body);\n\nconst imgRegex = /<img[^>]+src=[\"']([^\"']+)[\"'][^>]*>/gi;\nconst urls = [];\nlet match;\n\nwhile ((match = imgRegex.exec(text)) !== null) {\n  const src = match[1];\n\n  if (\n    !src.includes('logo') &&\n    !src.includes('sprite') &&\n    !src.includes('icon') &&\n    !src.includes('tracking') &&\n    !src.startsWith('data:')\n  ) {\n    urls.push(src);\n  }\n}\n\nconst mainImage = urls[0] || '';\n\nreturn [{\n  json: {\n    mainImage,\n    allImages: urls\n  }\n}];\n"
      },
      "name": "Extract Image URLs",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -1216,
        -784
      ],
      "id": "56540389-9d14-4e36-ba2c-97df901d669f"
    },
    {
      "parameters": {
        "url": "https://atom-game.ir/api/blog/categories/",
        "options": {
          "headers": {
            "Authorization": "={{$node[\"Auth Header\"].json.authorization}}"
          }
        }
      },
      "name": "Get Categories",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -1440,
        -928
      ],
      "id": "14576c6d-6421-4af1-938f-ad56a55c8eec"
    },
    {
      "parameters": {
        "functionCode": "const meta = $items('Clean URLs & Enhance Content')[0].json;\nconst desiredSlug = (meta.category_slug || '').toString().trim().toLowerCase();\n\nconst categories = items.map(i => i.json);\n\nfunction norm(v) {\n  return String(v || '').toLowerCase();\n}\n\nlet match = null;\nif (desiredSlug) {\n  match = categories.find(c => norm(c.slug) === desiredSlug);\n  if (!match) {\n    match = categories.find(c => norm(c.name) === desiredSlug);\n  }\n}\n\nconst needsCreate = !match;\n\nreturn [{\n  json: {\n    needsCreate,\n    category_id: match && match.id != null ? match.id : null,\n    category_slug: match && match.slug ? match.slug : (meta.category_slug || '').toString().trim().toLowerCase() || 'game-news',\n    category_name: match && match.name ? match.name : (meta.category_slug || 'Game News')\n  }\n}];\n"
      },
      "name": "Select Category",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -1216,
        -928
      ],
      "id": "fca66ad4-73bd-4ac0-886c-7e3bb86e2bae"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.needsCreate}}",
              "value2": true
            }
          ]
        }
      },
      "name": "If Create Category",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -992,
        -928
      ],
      "id": "3ecca170-c215-4dec-8e3f-3c4c5231fcb6"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://atom-game.ir/api/blog/categories/",
        "authentication": "predefinedCredentialType",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \"slug\": $json.category_slug, \"name\": $json.category_name, \"parent\": 0 } }}",
        "options": {
          "headers": {
            "Authorization": "={{$node[\"Auth Header\"].json.authorization}}"
          }
        }
      },
      "name": "Create Category",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -768,
        -1024
      ],
      "id": "4fdf6aa5-77c8-4062-9d86-8d37e0791e83"
    },
    {
      "parameters": {
        "functionCode": "return [{\n  json: {\n    category_id: $json.id,\n    category_slug: $json.slug,\n    category_name: $json.name\n  }\n}];\n"
      },
      "name": "Use Created Category",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -544,
        -1024
      ],
      "id": "f7e52659-80dc-4be3-8d91-3b24577101e6"
    },
    {
      "parameters": {
        "functionCode": "return [{\n  json: {\n    category_id: $json.category_id,\n    category_slug: $json.category_slug,\n    category_name: $json.category_name\n  }\n}];\n"
      },
      "name": "Use Existing Category",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -544,
        -832
      ],
      "id": "2745ef6c-37a1-40af-9ba9-0b2b3ec6dfae"
    },
    {
      "parameters": {},
      "name": "Final Category",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [
        -320,
        -928
      ],
      "id": "1095c03b-a5b6-4525-a5a6-c7e024ea9cbf"
    },
    {
      "parameters": {
        "url": "https://atom-game.ir/api/blog/tags/",
        "options": {
          "headers": {
            "Authorization": "={{$node[\"Auth Header\"].json.authorization}}"
          }
        }
      },
      "name": "Get Tags",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -1440,
        -160
      ],
      "id": "4411af3e-5456-45cf-a99c-bbf16ced9180"
    },
    {
      "parameters": {
        "functionCode": "const meta = $items('Clean URLs & Enhance Content')[0].json;\nconst desiredTags = Array.isArray(meta.tags) ? meta.tags : [];\n\nconst availableTags = items.map(i => i.json);\n\nfunction norm(v) {\n  return String(v || '').trim().toLowerCase();\n}\n\nfunction slugify(str) {\n  return norm(str)\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+|-+$/g, '');\n}\n\nconst TAG_ALIASES = {\n  'gta vi': 'gta-6',\n  'gta 6': 'gta-6',\n  'grand theft auto 6': 'gta-6',\n  'elden ring': 'elden-ring',\n  'call of duty': 'call-of-duty',\n  'cod': 'call-of-duty',\n  'playstation': 'playstation',\n  'ps5': 'playstation-5',\n  'xbox': 'xbox',\n  'nintendo switch': 'nintendo-switch',\n  'pc': 'pc-gaming'\n};\n\nconst tagRecords = [];\n\nfor (const tagName of desiredTags) {\n  const baseNorm = norm(tagName);\n  const aliasSlug = TAG_ALIASES[baseNorm];\n  const desiredSlug = aliasSlug || slugify(tagName);\n\n  let found = availableTags.find(\n    t => norm(t.slug) === desiredSlug || norm(t.name) === baseNorm\n  );\n\n  if (!found) {\n    found = availableTags.find(\n      t => norm(t.name) === baseNorm || norm(t.slug) === baseNorm\n    );\n  }\n\n  if (found && found.id != null) {\n    tagRecords.push({\n      name: found.name || tagName,\n      slug: found.slug || desiredSlug,\n      id: found.id,\n      needsCreate: false\n    });\n  } else {\n    tagRecords.push({\n      name: tagName,\n      slug: desiredSlug,\n      id: null,\n      needsCreate: true\n    });\n  }\n}\n\nreturn tagRecords.map(r => ({ json: r }));\n"
      },
      "name": "Build Tag IDs",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -1216,
        -160
      ],
      "id": "bdd2fb12-e3eb-4c1a-8b54-76c33223e702"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.needsCreate}}",
              "value2": true
            }
          ]
        }
      },
      "name": "If Create Tag",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -992,
        -160
      ],
      "id": "d138d76b-6b93-40ab-9ed2-02240cd1e57c"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://atom-game.ir/api/blog/tags/",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \"slug\": $json.slug, \"name\": $json.name } }}",
        "options": {
          "headers": {
            "Authorization": "={{$node[\"Auth Header\"].json.authorization}}"
          }
        }
      },
      "name": "Create Tag",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -768,
        -256
      ],
      "id": "68993494-ddf6-4541-ab9b-308b4029695c"
    },
    {
      "parameters": {
        "functionCode": "return [{\n  json: {\n    id: $json.id,\n    name: $json.name,\n    slug: $json.slug\n  }\n}];\n"
      },
      "name": "Use Created Tag",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -544,
        -256
      ],
      "id": "873fcc8f-a81f-4a15-8e17-8a673988b92b"
    },
    {
      "parameters": {
        "functionCode": "return [{\n  json: {\n    id: $json.id,\n    name: $json.name,\n    slug: $json.slug\n  }\n}];\n"
      },
      "name": "Use Existing Tag",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -544,
        -64
      ],
      "id": "2c450fd0-4bd7-4cdf-9c5c-d3d7bf413a72"
    },
    {
      "parameters": {},
      "name": "Final Tags",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [
        -320,
        -160
      ],
      "id": "9d800006-001a-4793-9cfa-8c0fe940702e"
    },
    {
      "parameters": {
        "functionCode": "const tagIds = items\n  .map(i => i.json && i.json.id)\n  .filter(id => id != null);\n\nreturn [{\n  json: {\n    tag_ids: tagIds\n  }\n}];\n"
      },
      "name": "Collect Tag IDs",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -96,
        -160
      ],
      "id": "00fbfb2b-0991-47bc-8def-acf5673e846b"
    },
    {
      "parameters": {
        "url": "https://atom-game.ir/api/blog/series/",
        "options": {
          "headers": {
            "Authorization": "={{$node[\"Auth Header\"].json.authorization}}"
          }
        }
      },
      "name": "Get Series",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -1440,
        -544
      ],
      "id": "1fc4e118-a72f-417e-91ca-e31482ff5e98"
    },
    {
      "parameters": {
        "functionCode": "const meta = $items('Clean URLs & Enhance Content')[0].json;\nconst desiredSlug = (meta.series_slug || '').toString().trim().toLowerCase();\n\nconst seriesList = items.map(i => i.json);\n\nfunction norm(v) {\n  return String(v || '').toLowerCase();\n}\n\nlet match = null;\nif (desiredSlug) {\n  match = seriesList.find(s => norm(s.slug) === desiredSlug);\n  if (!match) {\n    match = seriesList.find(s => norm(s.title) === desiredSlug);\n  }\n}\n\nconst needsCreate = !match;\n\nreturn [{\n  json: {\n    needsCreate,\n    series_id: match && match.id != null ? match.id : null,\n    series_slug: match && match.slug ? match.slug : (meta.series_slug || '').toString().trim().toLowerCase() || 'daily-digest',\n    series_title: match && match.title ? match.title : (meta.series_slug || 'Daily Digest')\n  }\n}];\n"
      },
      "name": "Select Series",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -1216,
        -544
      ],
      "id": "3bf33883-ef5e-4d43-b99c-84872ce8af0e"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.needsCreate}}",
              "value2": true
            }
          ]
        }
      },
      "name": "If Create Series",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -992,
        -544
      ],
      "id": "4a53756e-ce96-44db-973e-48c9d3d45309"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://atom-game.ir/api/blog/series/",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \"slug\": $json.series_slug, \"title\": $json.series_title, \"description\": \"\", \"order_strategy\": \"manual\" } }}",
        "options": {
          "headers": {
            "Authorization": "={{$node[\"Auth Header\"].json.authorization}}"
          }
        }
      },
      "name": "Create Series",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -768,
        -640
      ],
      "id": "a5a64516-c7f5-4d7f-93e8-d20da9286650"
    },
    {
      "parameters": {
        "functionCode": "return [{\n  json: {\n    series_id: $json.id,\n    series_slug: $json.slug,\n    series_title: $json.title\n  }\n}];\n"
      },
      "name": "Use Created Series",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -544,
        -640
      ],
      "id": "6ac04460-23ae-4a99-af98-9b5931100118"
    },
    {
      "parameters": {
        "functionCode": "return [{\n  json: {\n    series_id: $json.series_id,\n    series_slug: $json.series_slug,\n    series_title: $json.series_title\n  }\n}];\n"
      },
      "name": "Use Existing Series",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -544,
        -448
      ],
      "id": "9b17d29b-c7b5-479f-b4cb-95d6a68fb684"
    },
    {
      "parameters": {},
      "name": "Final Series",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [
        -320,
        -544
      ],
      "id": "9668afcb-7f84-4c81-9de5-755eeb23e6af"
    },
    {
      "parameters": {
        "functionCode": "const meta = $items('Clean URLs & Enhance Content')[0].json;          // Ù†Ø³Ø®Ù‡ V8: Ø¨Ø¹Ø¯ Ø§Ø² ØªÙ…ÛŒØ²Ú©Ø§Ø±ÛŒ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ Ùˆ ØªØ´Ø®ÛŒØµ Ø²Ø¨Ø§Ù†\nconst categoryInfo = $items('Final Category')[0].json;\nconst seriesInfo = $items('Final Series')[0].json;\nconst tagInfo = $items('Collect Tag IDs')[0].json;\nconst chosenWrapper = $items('Pick Chosen Article')[0].json;\nconst chosenArticle = chosenWrapper.chosen_article || null;\nconst imageInfo = $items('Extract Image URLs')[0].json || {};\nconst mediaInfo = $items('Collect Media Results')[0]?.json || {};\nconst mediaIds = mediaInfo.mediaIds || [];\nconst mediaUrls = mediaInfo.mediaUrls || [];\n\nconst langItem = $items('Clean URLs & Enhance Content')[0].json || {};\nconst lang = langItem.lang || 'fa';\n\nfunction slugify(str) {\n  return String(str || 'post')\n    .trim()\n    .toLowerCase()\n    .replace(/[Ø¢Ø§Ø¢Ø¥Ø¡Ø¦Ø¤Ø©]/g, 'a')\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+|-+$/g, '');\n}\n\nconst title = meta.title || 'Ø®Ù„Ø§ØµÙ‡ Ù…Ù‡Ù…â€ŒØªØ±ÛŒÙ† Ø®Ø¨Ø±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø§Ù…Ø±ÙˆØ²';\nconst slug = slugify(title);\n\nconst mainImage = imageInfo.mainImage || '';\n\nconst body = {\n  title,\n  excerpt: meta.excerpt || '',\n  content: meta.summary_markdown || '',\n  status: 'draft',\n  visibility: 'public',\n  seo_title: meta.seo_title || title,\n  seo_description: meta.seo_description || (meta.excerpt || ''),\n  slug,\n  canonical_url: `https://atom-game.ir/blog/${slug}/`,\n  language: lang\n};\n\nif (categoryInfo && categoryInfo.category_id != null) {\n  body.category_id = categoryInfo.category_id;\n}\n\nif (seriesInfo && seriesInfo.series_id != null) {\n  body.series = seriesInfo.series_id;\n}\n\nif (tagInfo && Array.isArray(tagInfo.tag_ids) && tagInfo.tag_ids.length > 0) {\n  body.tag_ids = tagInfo.tag_ids;\n}\n\n// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÙˆÙ„ÛŒÙ† Ù…Ø¯ÛŒØ§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ú©Ø§ÙˆØ±\nif (mediaIds.length > 0) {\n  body.cover_media = mediaIds[0];\n}\n\n// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØªØµØ§ÙˆÛŒØ± Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ù‡ Ø§Ù†ØªÙ‡Ø§ÛŒ Ù…Ø­ØªÙˆØ§ Ø¨Ù‡ ØµÙˆØ±Øª markdown\nif (Array.isArray(mediaUrls) && mediaUrls.length > 0) {\n  const imagesMd = mediaUrls.map(u => `![](${u})`).join('\n\n');\n  body.content = (body.content || '') + '\n\n' + imagesMd;\n}\n\n// Ø¨Ù‡ ØµÙˆØ±Øª fallback Ø§Ú¯Ø± Ù…Ø¯ÛŒØ§ Ù†Ø¯Ø§Ø´ØªÛŒÙ… Ùˆ mainImage Ø®Ø§Ø±Ø¬ÛŒ Ù‡Ø³Øª:\nif (!body.cover_media && mainImage) {\n  body.main_image_url = mainImage;\n}\n\nif (chosenArticle && chosenArticle.link) {\n  body.source_url = chosenArticle.link;\n}\n\nreturn [{ json: body }];\n"
      },
      "name": "Build Blog Post Payload",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -96,
        -928
      ],
      "id": "3b050521-f892-4f98-9cf0-b9ad92141d33"
    },
    {
      "parameters": {
        "url": "https://atom-game.ir/api/blog/posts/",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{$json.payload}}",
        "options": {
          "headers": {
            "Authorization": "={{$node[\"Auth Header\"].json.authorization}}"
          }
        }
      },
      "name": "Create Blog Post",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        144,
        -928
      ],
      "id": "d3e55a4a-db28-4e20-81a9-ded509eef623"
    },
    {
      "parameters": {
        "chatId": "2075065850",
        "text": "={{ $json.summary_markdown || $json.text || $json.output || $json.response }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "name": "Send Summary",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -1440,
        -352
      ],
      "id": "0563b876-5775-463c-9bda-40312de55ba5",
      "webhookId": "82bd8bb8-75c2-4de6-84a0-b8fd3261d9e2",
      "credentials": {
        "telegramApi": {
          "id": "0pPxcLhD8qdqCKlG",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "2075065850",
        "messageId": "={{$json.message_id}}",
        "text": "={{ \n  (()=>{\n    const total = ($items('Prepare Sources & Add IDs') || []).length || 0;\n    const currentIndex = $json.itemIndex + 1;\n    const src = $json.source || 'Ù†Ø§Ù…Ø´Ø®Øµ';\n    const ok = $json.success === true ? ' âœ…' : ' âŒ';\n    return `âš™ï¸ [${currentIndex}/${total}] Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯: ${src}${ok}`;\n  })()\n}}",
        "additionalFields": {}
      },
      "name": "Update Status",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -2688,
        272
      ],
      "id": "e802a691-7440-4795-a402-b57c27cb0824",
      "webhookId": "25694a74-b3b9-4e93-a908-fc17c290080f",
      "credentials": {
        "telegramApi": {
          "id": "0pPxcLhD8qdqCKlG",
          "name": "Telegram account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "2075065850",
        "messageId": "={{$node[\"Filter & Prepare All Articles\"].json.messageId}}",
        "text": "âœ… Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ø§Ù…Ù„ Ø´Ø¯. Ø®Ù„Ø§ØµÙ‡ Ø§Ø®Ø¨Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ú¯Ø±Ø¯ÛŒØ¯.",
        "additionalFields": {}
      },
      "name": "Update Final Status (Success)",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -1216,
        -352
      ],
      "id": "b67d04ac-940b-48df-a65b-17b1095291b3",
      "webhookId": "137e69ab-b2b0-4b85-b32d-389ec022d6b1",
      "credentials": {
        "telegramApi": {
          "id": "0pPxcLhD8qdqCKlG",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "return [{ json: { authorization: `Bearer ${$node[\"Auth Tokens\"].json.access}` } }];"
      },
      "name": "Auth Header",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -4144,
        208
      ],
      "id": "3b4e5844-5fb5-44d5-8cdb-4ebbbbc1fdb0"
    },
    {
      "parameters": {
        "method": "GET",
        "url": "={{$json.allImages}}",
        "responseFormat": "file",
        "binaryPropertyName": "image",
        "options": {},
        "dataPropertyName": "image"
      },
      "name": "Download Image",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -960,
        -784
      ],
      "id": "1a22b1c6-c4a1-433d-ad26-15712f2ab90f"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://atom-game.ir/api/blog/media/",
        "sendBinaryData": true,
        "binaryPropertyName": "image",
        "options": {
          "bodyContentType": "multipart-form-data",
          "headers": {
            "Authorization": "={{$node[\"Auth Header\"].json.authorization}}"
          }
        },
        "sendBody": true
      },
      "name": "Create Media",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -736,
        -784
      ],
      "id": "ac0ae42e-ee36-4fb3-be74-debc89a2bd6c"
    },
    {
      "parameters": {
        "functionCode": "const item = items[0] || { json: {} };\n\n// Wrap payload if not already nested\nif (!item.json.payload) {\n  item.json = { payload: { ...item.json } };\n}\n\nitem.json.attempt = item.json.attempt ?? 1;\nitem.json.max_attempts = item.json.max_attempts ?? 3;\n\nreturn [item];"
      },
      "name": "Init Loop State",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        144,
        -1104
      ],
      "id": "79290e0f-0688-4335-9bdd-a7428015a724"
    },
    {
      "parameters": {
        "functionCode": "const item = items[0] || { json: {} };\nconst payload = item.json.payload || {};\n\nconst passReview = (item.json.attempt || 1) > 1;\n\nitem.json.review = {\n  pass: passReview,\n  score: passReview ? 90 : 70,\n  issues: passReview\n    ? []\n    : [\n        { type: 'style', severity: 'high', fix: 'Ú©ÙˆØªØ§Ù‡â€ŒØªØ± Ú©Ø±Ø¯Ù† Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ùâ€ŒÙ‡Ø§ Ùˆ Ø­Ø°Ù ØªÚ©Ø±Ø§Ø±' },\n        { type: 'seo', severity: 'medium', fix: 'Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªÛŒØªØ±Ù‡Ø§ÛŒ H2 Ùˆ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ' },\n      ],\n  rewrite_instructions: passReview\n    ? ''\n    : 'Ù…ØªÙ† Ø±Ø§ Ø®Ø¨Ø±ÛŒâ€ŒØªØ± Ú©Ù†ØŒ Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ùâ€ŒÙ‡Ø§ Ø±Ø§ Ú©ÙˆØªØ§Ù‡ Ú©Ù†ØŒ Ùˆ ÛŒÚ© Ø¬Ù…Ø¹â€ŒØ¨Ù†Ø¯ÛŒ Ú©ÙˆØªØ§Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†.'\n};\n\n// Preserve payload for downstream nodes\nitem.json.payload = payload;\n\nreturn [item];"
      },
      "name": "AI Review",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        384,
        -1104
      ],
      "id": "71d04aa3-70cb-440d-b977-b78fe574ff16"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.review.pass}}",
              "value2": true
            }
          ]
        }
      },
      "name": "IF Review Passed?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        624,
        -1104
      ],
      "id": "e0e04c8b-d752-4f20-a2ed-a761ae961324"
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.attempt}}",
              "operation": "smaller",
              "value2": "={{$json.max_attempts}}"
            }
          ]
        }
      },
      "name": "Check Attempts Left",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        624,
        -944
      ],
      "id": "14492958-b7f0-4334-b34f-8f2cd9358329"
    },
    {
      "parameters": {
        "functionCode": "const item = items[0] || { json: {} };\nconst { attempt, max_attempts, review, rewrite, ...payload } = item.json.payload ? { ...item.json.payload } : { ...item.json };\n\nconst instructions = item.json.review?.rewrite_instructions || '';\n\nitem.json.rewrite = {\n  payload: {\n    ...payload,\n    content: `${payload.content || ''}\n\n---\n\n[AI Rewrite]\n${instructions || 'Ù†Ø³Ø®Ù‡ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒâ€ŒØ´Ø¯Ù‡ Ø¬Ù‡Øª Ø¨Ù‡Ø¨ÙˆØ¯ Ú©ÛŒÙÛŒØª.'}`.trim(),\n    summary: payload.summary || 'Ø®Ù„Ø§ØµÙ‡: Ù†Ø³Ø®Ù‡ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒâ€ŒØ´Ø¯Ù‡ Ø¬Ù‡Øª Ø¨Ù‡Ø¨ÙˆØ¯ Ú©ÛŒÙÛŒØª.'\n  }\n};\n\nreturn [item];"
      },
      "name": "AI Rewrite",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        864,
        -944
      ],
      "id": "4c9a0e78-3f89-418a-82d5-cbde91a1ca02"
    },
    {
      "parameters": {
        "functionCode": "const item = items[0] || { json: {} };\nconst newPayload = item.json.rewrite?.payload;\nconst attempt = item.json.attempt ?? 1;\nconst maxAttempts = item.json.max_attempts ?? 3;\n\nif (newPayload) {\n  item.json = {\n    payload: newPayload,\n    attempt: attempt + 1,\n    max_attempts: maxAttempts\n  };\n}\n\nreturn [item];"
      },
      "name": "Apply Rewritten Payload",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1104,
        -944
      ],
      "id": "96f739ff-cc4c-46bd-9640-4043fba326d9"
    },
    {
      "id": "ffcf3774-8388-4d77-85f2-45e4b12b6a87",
      "name": "Split Out Images",
      "parameters": {
        "fieldToSplitOut": "allImages",
        "options": {},
        "operation": "splitOutItems"
      },
      "position": [
        -1184,
        -784
      ],
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 1
    },
    {
      "id": "d628ad17-40eb-4dd1-89bf-e3b29b036876",
      "name": "Collect Media Results",
      "parameters": {
        "functionCode": "const mediaIds = [];\nconst mediaUrls = [];\n\nfor (const item of items) {\n  const j = item.json || {};\n  if (j.id != null) mediaIds.push(j.id);\n\n  const url = j.url || j.file || j.file_url || j.original || j.download_url;\n  if (url) mediaUrls.push(url);\n}\n\nreturn [{\n  json: { mediaIds, mediaUrls }\n}];"
      },
      "position": [
        -512,
        -784
      ],
      "type": "n8n-nodes-base.function",
      "typeVersion": 1
    }
  ],
  "pinData": {},
  "connections": {
    "Daily Trigger": {
      "main": [
        [
          {
            "node": "Auth Tokens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Initial Status": {
      "main": [
        [
          {
            "node": "Prepare Sources & Add IDs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Sources & Add IDs": {
      "main": [
        [
          {
            "node": "Split Sources",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Sources": {
      "main": [
        [
          {
            "node": "RSS Feed Read",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RSS Feed Read": {
      "main": [
        [
          {
            "node": "Tag Success/Fail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tag Success/Fail": {
      "main": [
        [
          {
            "node": "Status Per Source",
            "type": "main",
            "index": 0
          },
          {
            "node": "Wait for Loop to Finish",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Status Per Source": {
      "main": [
        [
          {
            "node": "If Has MsgID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Has MsgID": {
      "main": [
        [
          {
            "node": "Update Status",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Split Sources",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait for Loop to Finish": {
      "main": [
        [
          {
            "node": "Filter & Prepare All Articles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter & Prepare All Articles": {
      "main": [
        [
          {
            "node": "If Articles Exist",
            "type": "main",
            "index": 0
          },
          {
            "node": "Check for Prep Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check for Prep Error": {
      "main": [
        [
          {
            "node": "Send Error to Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Articles Exist": {
      "main": [
        [
          {
            "node": "Get Recent Posts",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Final Status (No Articles)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Recent Posts": {
      "main": [
        [
          {
            "node": "Analyze SEO Performance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze SEO Performance": {
      "main": [
        [
          {
            "node": "AI Memory Builder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Memory Builder": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Parse AI JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI JSON": {
      "main": [
        [
          {
            "node": "Clean URLs & Enhance Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clean URLs & Enhance Content": {
      "main": [
        [
          {
            "node": "Send Summary",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Categories",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Tags",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Series",
            "type": "main",
            "index": 0
          },
          {
            "node": "Pick Chosen Article",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pick Chosen Article": {
      "main": [
        [
          {
            "node": "Fetch Original Article HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Original Article HTML": {
      "main": [
        [
          {
            "node": "Extract Image URLs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Categories": {
      "main": [
        [
          {
            "node": "Select Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select Category": {
      "main": [
        [
          {
            "node": "If Create Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Create Category": {
      "main": [
        [
          {
            "node": "Create Category",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Use Existing Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Category": {
      "main": [
        [
          {
            "node": "Use Created Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Use Created Category": {
      "main": [
        [
          {
            "node": "Final Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Use Existing Category": {
      "main": [
        [
          {
            "node": "Final Category",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Final Category": {},
    "Get Tags": {
      "main": [
        [
          {
            "node": "Build Tag IDs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Tag IDs": {
      "main": [
        [
          {
            "node": "If Create Tag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Create Tag": {
      "main": [
        [
          {
            "node": "Create Tag",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Use Existing Tag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Tag": {
      "main": [
        [
          {
            "node": "Use Created Tag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Use Created Tag": {
      "main": [
        [
          {
            "node": "Final Tags",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Use Existing Tag": {
      "main": [
        [
          {
            "node": "Final Tags",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Final Tags": {
      "main": [
        [
          {
            "node": "Collect Tag IDs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Series": {
      "main": [
        [
          {
            "node": "Select Series",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select Series": {
      "main": [
        [
          {
            "node": "If Create Series",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Create Series": {
      "main": [
        [
          {
            "node": "Create Series",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Use Existing Series",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Series": {
      "main": [
        [
          {
            "node": "Use Created Series",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Use Created Series": {
      "main": [
        [
          {
            "node": "Final Series",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Use Existing Series": {
      "main": [
        [
          {
            "node": "Final Series",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Build Blog Post Payload": {
      "main": [
        [
          {
            "node": "Init Loop State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Summary": {
      "main": [
        [
          {
            "node": "Update Final Status (Success)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Auth Tokens": {
      "main": [
        [
          {
            "node": "Auth Header",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Auth Header": {
      "main": [
        [
          {
            "node": "Send Initial Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Image URLs": {
      "main": [
        [
          {
            "index": 0,
            "node": "Split Out Images",
            "type": "main"
          }
        ]
      ]
    },
    "Create Media": {
      "main": [
        [
          {
            "index": 0,
            "node": "Collect Media Results",
            "type": "main"
          }
        ]
      ]
    },
    "Init Loop State": {
      "main": [
        [
          {
            "node": "AI Review",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Review": {
      "main": [
        [
          {
            "node": "IF Review Passed?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Review Passed?": {
      "main": [
        [
          {
            "node": "Create Blog Post",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Attempts Left",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Attempts Left": {
      "main": [
        [
          {
            "node": "AI Rewrite",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Blog Post",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Rewrite": {
      "main": [
        [
          {
            "node": "Apply Rewritten Payload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Apply Rewritten Payload": {
      "main": [
        [
          {
            "node": "AI Review",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out Images": {
      "main": [
        [
          {
            "index": 0,
            "node": "Download Image",
            "type": "main"
          }
        ]
      ]
    },
    "Download Image": {
      "main": [
        [
          {
            "index": 0,
            "node": "Create Media",
            "type": "main"
          }
        ]
      ]
    },
    "Collect Media Results": {
      "main": [
        [
          {
            "index": 0,
            "node": "Build Blog Post Payload",
            "type": "main"
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "5475c985-76a6-4021-b05e-20ba7ce78a5b",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "da8708924ec3c6ead20a24a1ef9241a21b82f968691cc79b00ffb8a180edc98b"
  },
  "id": "IOtSNu11iKwZx5m4",
  "tags": []
}